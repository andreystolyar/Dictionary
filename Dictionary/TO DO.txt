Поиск не работает.

Что с кодировкой в читаемом файле?

Сделать событие на изменение флагов после открытия, сохранения и т.д.

Стоит выбрать более рациональный способ выбора случайных записей.
